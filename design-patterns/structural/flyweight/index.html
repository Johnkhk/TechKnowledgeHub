
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../facade/" rel="prev"/>
<link href="../proxy/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.0, mkdocs-material-9.5.26" name="generator"/>
<title>Flyweight - Tech Knowledge Hub</title>
<link href="../../../assets/stylesheets/main.6543a935.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#flyweight-pattern">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Tech Knowledge Hub" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Tech Knowledge Hub">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Tech Knowledge Hub
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Flyweight
            
          </span>
</div>
</div>
</div>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Tech Knowledge Hub" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Tech Knowledge Hub">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Tech Knowledge Hub
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Design Patterns
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Design Patterns
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../design-patterns/">
<span class="md-ellipsis">
    Overview
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-ellipsis">
    Creational
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            Creational
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../creational/singleton/">
<span class="md-ellipsis">
    Singleton
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../creational/factory-method/">
<span class="md-ellipsis">
    Factory Method
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../creational/abstract-factory/">
<span class="md-ellipsis">
    Abstract Factory
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../creational/builder/">
<span class="md-ellipsis">
    Builder
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../creational/prototype/">
<span class="md-ellipsis">
    Prototype
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../creational/object-pool/">
<span class="md-ellipsis">
    Object Pool
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-ellipsis">
    Structural
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            Structural
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../adapter/">
<span class="md-ellipsis">
    Adapter
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bridge/">
<span class="md-ellipsis">
    Bridge
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../composite/">
<span class="md-ellipsis">
    Composite
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../decorator/">
<span class="md-ellipsis">
    Decorator
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../facade/">
<span class="md-ellipsis">
    Facade
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Flyweight
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Flyweight
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#description">
<span class="md-ellipsis">
      Description
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benefits">
<span class="md-ellipsis">
      Benefits
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
<span class="md-ellipsis">
      Example
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation">
<span class="md-ellipsis">
      Implementation
    </span>
</a>
<nav aria-label="Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#diagram">
<span class="md-ellipsis">
      Diagram
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code-implementation">
<span class="md-ellipsis">
      Code Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code-usage">
<span class="md-ellipsis">
      Code Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../proxy/">
<span class="md-ellipsis">
    Proxy
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-ellipsis">
    Behavioral
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            Behavioral
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/chain-of-responsibility/">
<span class="md-ellipsis">
    Chain of Responsibility
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/command/">
<span class="md-ellipsis">
    Command
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/iterator/">
<span class="md-ellipsis">
    Iterator
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/mediator/">
<span class="md-ellipsis">
    Mediator
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/memento/">
<span class="md-ellipsis">
    Memento
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/observer/">
<span class="md-ellipsis">
    Observer
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/state/">
<span class="md-ellipsis">
    State
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/strategy/">
<span class="md-ellipsis">
    Strategy
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/template-method/">
<span class="md-ellipsis">
    Template Method
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../behavioral/visitor/">
<span class="md-ellipsis">
    Visitor
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system-design/">
<span class="md-ellipsis">
    System Design
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#description">
<span class="md-ellipsis">
      Description
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benefits">
<span class="md-ellipsis">
      Benefits
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
<span class="md-ellipsis">
      Example
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation">
<span class="md-ellipsis">
      Implementation
    </span>
</a>
<nav aria-label="Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#diagram">
<span class="md-ellipsis">
      Diagram
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code-implementation">
<span class="md-ellipsis">
      Code Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code-usage">
<span class="md-ellipsis">
      Code Usage
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="flyweight-pattern">Flyweight Pattern<a class="headerlink" href="#flyweight-pattern" title="Permanent link">¶</a></h1>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">¶</a></h2>
<p>flyweight is a structural design pattern that provides lets you fit more objects into the available amount of RAM by sharing common parts of state between multiple objects, instead of keeping all of the data in each object.</p>
<p>Let's say you made a game with particles and when you play it, it keeps crashing. Looks like each particle stores color and sprite are same for this effect, while position, movement vector and speed are unique. </p>
<p>So the color and sprite are <strong>intrinsic states</strong>. While the position, movement vector and speed are <strong>extrinsic states</strong>.</p>
<p>The intrinsic state is shared among multiple objects, while the extrinsic state can vary and is passed to the flyweight objects as needed. The extrinsic states of objects are moved to a container object. </p>
<p>Flyweight shows how to make lots of little objects, whereas <a href="/design-patterns/structural/facade.md">Facade</a> shows how to make a single object that represents an entire subsystem.</p>
<p>Flyweight is like <a href="/design-patterns/creational/singleton.md">Singleton</a> except Flyweight can have multiple instances with different intrinsic states. Also, Flyweight objects are immutable.</p>
<p>You might be trading RAM over CPU cycles when some of the context data needs to be recalculated each time somebody calls a flyweight method.</p>
<h2 id="benefits">Benefits<a class="headerlink" href="#benefits" title="Permanent link">¶</a></h2>
<ol>
<li><strong>Save memory</strong>:  Your app can spawn a huge number of similar objects. </li>
</ol>
<h2 id="example">Example<a class="headerlink" href="#example" title="Permanent link">¶</a></h2>
<p>Let's say you a rendering millions of tree objects in a game. Each tree has a name, color, texture, position, and size. We move the <strong>name</strong>, <strong>color</strong>, and <strong>texture</strong> to the flyweight class (TreeType). Now, our code can create trees using a flyweight factory. </p>
<p>In this example:</p>
<ul>
<li><code>Tree</code> is the class that represents the tree object. </li>
<li><code>TreeType</code> is the flyweight class that stores the intrinsic states of the tree.</li>
<li><code>TreeFactory</code> is the flyweight factory that creates and manages the flyweight objects.</li>
</ul>
<h2 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">¶</a></h2>
<ul>
<li><code>TreeFactory</code> has a factory method <code>getFlyweight(repeatingState)</code> - <code>getTreeType(name, color, texture)</code> that accepts the intrinsic state of the desired flyweight from a client, looks for an existing flyweight object matching this state, and returns it if it was found. If not, it creates a new flyweight and adds it to the pool.</li>
<li><code>TreeFactory</code> also has a cache: <code>treeTypes: TreeType[]</code> that stores the flyweight objects.</li>
<li><code>Forest</code> is the client which can <code>plantTree(x, y, name, color, texture)</code> and <code>draw()</code>.</li>
<li>The key to the pattern is <code>planTree</code> which uses the <code>TreeFactory</code> to reuse the flyweight objects. So multiple trees can share the same <code>TreeType</code> object. Thus, saving memory.</li>
</ul>
<h3 id="diagram">Diagram<a class="headerlink" href="#diagram" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>classDiagram
    class Tree {
        -TreeType type
        -x
        -y
        +draw(canvas)
    }

    class TreeType {
        -name
        -color
        -texture
        +TreeType(name, color, texture)
        +draw(canvas x, y)
    }

    class TreeFactory {
        -TreeType[] treeTypes
        +getTreeType(name, color, texture) TreeType
    }

    class Forest {
        -Tree[] trees
        +plantTree(int x, int y, String name, String color, String texture)
        +draw()
    }

    Tree &lt;|--  TreeType
    TreeFactory &lt;|--  TreeType
    Forest &lt;|-- Tree

</code></pre>
<h3 id="code-implementation">Code Implementation<a class="headerlink" href="#code-implementation" title="Permanent link">¶</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">Python</label><label for="__tabbed_1_2">Go</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>


<span class="k">class</span> <span class="nc">TreeType</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">texture</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">texture</span> <span class="o">=</span> <span class="n">texture</span>


<span class="k">class</span> <span class="nc">Tree</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tree_type</span><span class="p">:</span> <span class="n">TreeType</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_type</span> <span class="o">=</span> <span class="n">tree_type</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Drawing on canvas"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TreeFactory</span><span class="p">:</span>
    <span class="n">tree_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TreeType</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_tree_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TreeType</span><span class="p">:</span>
        <span class="c1"># Look for existing tree type</span>
        <span class="k">for</span> <span class="n">tree_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">tree_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span>
                <span class="ow">and</span> <span class="n">tree_type</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">color</span>
                <span class="ow">and</span> <span class="n">tree_type</span><span class="o">.</span><span class="n">texture</span> <span class="o">==</span> <span class="n">texture</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">tree_type</span>
        <span class="c1"># If not found, create a new one and add it to the list</span>
        <span class="n">tree_type</span> <span class="o">=</span> <span class="n">TreeType</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tree_type</span>


<span class="k">class</span> <span class="nc">Forest</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tree</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">plant_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tree</span><span class="p">:</span>
        <span class="n">tree_type</span> <span class="o">=</span> <span class="n">TreeFactory</span><span class="p">()</span><span class="o">.</span><span class="n">get_tree_type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tree_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tree</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trees</span><span class="p">:</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">flyweight</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">"fmt"</span>
<span class="p">)</span>

<span class="c1">// TreeType represents the shared intrinsic state of a tree</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">TreeType</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">    </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Color</span><span class="w">   </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Texture</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Tree represents a tree object with extrinsic state (x, y) and intrinsic state (TreeType)</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Tree</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">X</span><span class="w">        </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">Y</span><span class="w">        </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">TreeType</span><span class="w"> </span><span class="o">*</span><span class="nx">TreeType</span>
<span class="p">}</span>

<span class="c1">// Draw simulates drawing the tree on a canvas</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">Tree</span><span class="p">)</span><span class="w"> </span><span class="nx">Draw</span><span class="p">(</span><span class="nx">canvas</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Drawing tree on %s at (%d, %d) with type (%s, %s, %s)\n"</span><span class="p">,</span>
<span class="w">        </span><span class="nx">canvas</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">X</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">Y</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">TreeType</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">TreeType</span><span class="p">.</span><span class="nx">Color</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">TreeType</span><span class="p">.</span><span class="nx">Texture</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// TreeFactory manages the creation and reuse of TreeType instances</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">TreeFactory</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">treeTypes</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">TreeType</span>
<span class="p">}</span>

<span class="c1">// GetTreeType returns an existing TreeType if found, or creates a new one</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">TreeFactory</span><span class="p">)</span><span class="w"> </span><span class="nx">GetTreeType</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">texture</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">TreeType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">treeType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">treeTypes</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">treeType</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">treeType</span><span class="p">.</span><span class="nx">Color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">treeType</span><span class="p">.</span><span class="nx">Texture</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">texture</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">treeType</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">treeType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TreeType</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">Texture</span><span class="p">:</span><span class="w"> </span><span class="nx">texture</span><span class="p">}</span>
<span class="w">    </span><span class="nx">f</span><span class="p">.</span><span class="nx">treeTypes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">treeTypes</span><span class="p">,</span><span class="w"> </span><span class="nx">treeType</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">treeType</span>
<span class="p">}</span>

<span class="c1">// Forest represents a collection of trees</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Forest</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">trees</span><span class="w">       </span><span class="p">[]</span><span class="o">*</span><span class="nx">Tree</span>
<span class="w">    </span><span class="nx">treeFactory</span><span class="w"> </span><span class="o">*</span><span class="nx">TreeFactory</span>
<span class="p">}</span>

<span class="c1">// PlantTree plants a new tree in the forest</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">Forest</span><span class="p">)</span><span class="w"> </span><span class="nx">PlantTree</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">texture</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">treeType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">treeFactory</span><span class="p">.</span><span class="nx">GetTreeType</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">texture</span><span class="p">)</span>
<span class="w">    </span><span class="nx">tree</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Tree</span><span class="p">{</span><span class="nx">X</span><span class="p">:</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">Y</span><span class="p">:</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">TreeType</span><span class="p">:</span><span class="w"> </span><span class="nx">treeType</span><span class="p">}</span>
<span class="w">    </span><span class="nx">f</span><span class="p">.</span><span class="nx">trees</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">trees</span><span class="p">,</span><span class="w"> </span><span class="nx">tree</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Draw draws all the trees in the forest</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">Forest</span><span class="p">)</span><span class="w"> </span><span class="nx">Draw</span><span class="p">(</span><span class="nx">canvas</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tree</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">trees</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">tree</span><span class="p">.</span><span class="nx">Draw</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</input></input></div>
<h3 id="code-usage">Code Usage<a class="headerlink" href="#code-usage" title="Permanent link">¶</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"><input id="__tabbed_2_2" name="__tabbed_2" type="radio"><div class="tabbed-labels"><label for="__tabbed_2_1">Python</label><label for="__tabbed_2_2">Go</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyweight</span> <span class="kn">import</span> <span class="n">Forest</span>

<span class="n">forest</span> <span class="o">=</span> <span class="n">Forest</span><span class="p">()</span>
<span class="c1"># The same tree type is shared between the two trees</span>
<span class="n">forest</span><span class="o">.</span><span class="n">plant_tree</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Oak"</span><span class="p">,</span> <span class="s2">"Green"</span><span class="p">,</span> <span class="s2">"Rough"</span><span class="p">)</span>
<span class="n">forest</span><span class="o">.</span><span class="n">plant_tree</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"Oak"</span><span class="p">,</span> <span class="s2">"Green"</span><span class="p">,</span> <span class="s2">"Rough"</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">treeFactory</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TreeFactory</span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// pointer to Forest struct</span>
<span class="w">    </span><span class="nx">forest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Forest</span><span class="p">{</span>
<span class="w">        </span><span class="nx">trees</span><span class="p">:</span><span class="w">       </span><span class="p">[]</span><span class="o">*</span><span class="nx">Tree</span><span class="p">{},</span>
<span class="w">        </span><span class="nx">treeFactory</span><span class="p">:</span><span class="w"> </span><span class="nx">treeFactory</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// These two trees share the same intrinsic state (TreeType)</span>
<span class="w">    </span><span class="nx">forest</span><span class="p">.</span><span class="nx">PlantTree</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">"Oak"</span><span class="p">,</span><span class="w"> </span><span class="s">"Green"</span><span class="p">,</span><span class="w"> </span><span class="s">"Rough"</span><span class="p">)</span>
<span class="w">    </span><span class="nx">forest</span><span class="p">.</span><span class="nx">PlantTree</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s">"Oak"</span><span class="p">,</span><span class="w"> </span><span class="s">"Green"</span><span class="p">,</span><span class="w"> </span><span class="s">"Rough"</span><span class="p">)</span>

<span class="w">    </span><span class="nx">forest</span><span class="p">.</span><span class="nx">PlantTree</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s">"Pine"</span><span class="p">,</span><span class="w"> </span><span class="s">"Green"</span><span class="p">,</span><span class="w"> </span><span class="s">"Smooth"</span><span class="p">)</span>

<span class="w">    </span><span class="nx">canvas</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">"MyCanvas"</span>
<span class="w">    </span><span class="nx">forest</span><span class="p">.</span><span class="nx">Draw</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</input></input></div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.ad660dcc.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>